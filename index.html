<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—¥æœ¬èªž N5/N4 | 365-Day Course</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f8f9fa;color:#2c3e50;min-height:100vh}
.app{display:flex;flex-direction:column;min-height:100vh}
.header{background:#2c3e50;color:#fff;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.header h1{font-size:1.2rem;font-weight:700}
.header-right{display:flex;align-items:center;gap:12px}
.progress-wrap{display:flex;align-items:center;gap:8px;font-size:0.8rem}
.progress-bar{width:140px;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:#27ae60;transition:width 0.3s}
.view-btns{display:flex;gap:4px}
.view-btn{padding:5px 12px;border:1px solid rgba(255,255,255,0.3);background:transparent;color:#fff;border-radius:4px;cursor:pointer;font-size:0.8rem;transition:background 0.2s}
.view-btn.active,.view-btn:hover{background:rgba(255,255,255,0.15)}
.main{flex:1;padding:20px;max-width:900px;margin:0 auto;width:100%}
.day-card{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);overflow:hidden}
.day-header{padding:20px 24px 16px;border-bottom:2px solid #f0f0f0}
.day-meta{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap}
.day-num{font-size:2rem;font-weight:800;color:#2c3e50}
.phase-badge{padding:4px 12px;border-radius:20px;font-size:0.75rem;font-weight:600;color:#fff}
.week-badge{padding:4px 10px;border-radius:20px;font-size:0.75rem;font-weight:500;background:#f0f0f0;color:#666}
.complete-badge{padding:4px 12px;border-radius:20px;font-size:0.75rem;font-weight:600;background:#27ae60;color:#fff}
.day-title{font-size:1.4rem;font-weight:700;color:#2c3e50;line-height:1.3}
.day-body{padding:20px 24px}
.section{margin-bottom:20px}
.section-label{font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#999;margin-bottom:8px}
.intro-text{font-size:0.95rem;line-height:1.6;color:#555;padding:12px 16px;background:#f8f9fa;border-radius:8px;border-left:3px solid #3498db}
.chars-table{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin-top:4px}
.char-card{text-align:center;padding:12px 8px;background:#f8f9fa;border-radius:8px;border:1px solid #e0e0e0}
.char-jp{font-size:2.2rem;line-height:1;display:block;margin-bottom:4px}
.char-reading{font-size:0.8rem;color:#666;font-weight:500}
.vocab-table{width:100%;border-collapse:separate;border-spacing:0 4px}
.vocab-table thead tr{background:none}
.vocab-table th{padding:4px 12px;font-size:0.75rem;font-weight:600;color:#999;text-transform:uppercase;letter-spacing:0.05em;background:none}
.vocab-table tbody tr{background:#f8f9fa;border-radius:6px}
.vocab-table td{padding:8px 12px;font-size:0.9rem}
.vocab-table td:first-child{font-size:1.1rem;font-weight:600;color:#2c3e50;border-radius:6px 0 0 6px}
.vocab-table td:last-child{color:#27ae60;font-weight:500;border-radius:0 6px 6px 0}
.vocab-table td:nth-child(2):not(:last-child){color:#666;font-size:0.85rem}
.grammar-box{background:linear-gradient(135deg,#667eea15,#764ba215);border:1px solid #764ba230;border-radius:10px;padding:14px 16px}
.grammar-pattern{font-size:1.1rem;font-weight:700;color:#8e44ad;margin-bottom:4px}
.grammar-meaning{font-size:0.85rem;color:#666;margin-bottom:8px}
.grammar-example{font-size:0.9rem}
.grammar-example .jp{font-weight:600;color:#2c3e50}
.grammar-example .en{color:#888;font-size:0.85rem;margin-top:2px}
.practice-box{background:#fff8e1;border:1px solid #ffe082;border-radius:8px;padding:12px 16px;font-size:0.9rem;line-height:1.6;color:#5d4037;white-space:pre-line}
.tip-box{background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:12px 16px;font-size:0.85rem;line-height:1.6;color:#2e7d32}
.tip-box::before{content:"ðŸ’¡ ";}
.nav-bar{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-top:1px solid #f0f0f0;background:#fafafa;gap:12px}
.nav-btn{padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-size:0.9rem;font-weight:600;transition:all 0.2s}
.nav-btn.prev{background:#f0f0f0;color:#666}
.nav-btn.prev:hover{background:#e0e0e0}
.nav-btn.next{background:#2c3e50;color:#fff}
.nav-btn.next:hover{background:#1a252f}
.nav-btn.complete{background:#27ae60;color:#fff;padding:10px 16px}
.nav-btn.complete.done{background:#e74c3c}
.nav-btn.complete:hover{opacity:0.85}
.nav-btn:disabled{opacity:0.3;cursor:not-allowed}
.day-counter{font-size:0.85rem;color:#999;text-align:center}
/* Overview */
.overview{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);padding:24px}
.overview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px}
.overview h2{font-size:1.3rem;font-weight:700}
.phase-legend{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.legend-item{display:flex;align-items:center;gap:4px;font-size:0.75rem;font-weight:500}
.legend-dot{width:10px;height:10px;border-radius:50%}
.cal-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(32px,1fr));gap:3px}
.cal-day{width:100%;aspect-ratio:1;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.6rem;font-weight:600;color:rgba(255,255,255,0.9);transition:transform 0.1s,opacity 0.2s;border:2px solid transparent}
.cal-day:hover{transform:scale(1.15);z-index:1;opacity:0.9}
.cal-day.current{border-color:#2c3e50;box-shadow:0 0 0 1px rgba(255,255,255,0.5)}
.cal-day.done{opacity:0.7}
.cal-day.done::after{content:"âœ“";font-size:0.65rem}
@media(max-width:600px){
  .chars-table{grid-template-columns:repeat(auto-fill,minmax(65px,1fr))}
  .day-title{font-size:1.1rem}
  .main{padding:12px}
}

/* Typing tip */
.typing-tip-box{background:#eef6fd;border:1px solid #a8d4f5;border-radius:8px;padding:12px 16px}
.typing-examples{font-family:'Courier New',monospace;font-size:0.95rem;color:#2c3e50;line-height:1.8;word-break:break-all}
.typing-note{color:#c0392b;font-size:0.82rem;margin-top:6px;font-weight:600}
.typing-hint{color:#888;font-size:0.78rem;margin-top:6px;font-style:italic;border-top:1px solid #d0e8f8;padding-top:6px}
/* Exercises */
.exercise-box{background:#fff;border:2px solid #e8e8e8;border-radius:10px;padding:16px 18px}
.ex-count{font-size:0.78rem;color:#bbb;font-weight:400;margin-left:6px;text-transform:none;letter-spacing:0}
.ex-prompt{font-size:0.78rem;color:#aaa;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px}
.ex-question{font-size:2rem;font-weight:700;color:#2c3e50;margin-bottom:16px;text-align:center;line-height:1.2;min-height:2.4rem}
.ex-options{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.ex-option{padding:11px 14px;border:2px solid #e0e0e0;background:#fafafa;border-radius:8px;cursor:pointer;font-size:0.95rem;text-align:left;transition:border-color 0.15s,background 0.15s;font-family:inherit;line-height:1.3}
.ex-option:hover:not(:disabled){background:#f0f0f0;border-color:#ccc}
.ex-option:disabled{cursor:default}
.ex-option.correct{background:#eafaf1!important;border-color:#27ae60!important;color:#196f3d}
.ex-option.wrong{background:#fdecea!important;border-color:#e74c3c!important;color:#922b21}
.ex-typing-row{display:flex;gap:8px;align-items:stretch;flex-wrap:wrap}
.ex-input{flex:1;min-width:120px;padding:10px 14px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;outline:none;font-family:inherit}
.ex-input:focus{border-color:#3498db}
.ex-input:disabled{background:#f8f9fa}
.ex-check-btn{padding:10px 18px;background:#3498db;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.9rem;white-space:nowrap;font-family:inherit;transition:background 0.15s}
.ex-check-btn:hover:not(:disabled){background:#2980b9}
.ex-check-btn:disabled{opacity:0.35;cursor:not-allowed}
.ex-feedback{padding:9px 14px;border-radius:8px;font-weight:600;font-size:0.9rem;margin-top:8px}
.ex-feedback.correct{background:#eafaf1;color:#196f3d}
.ex-feedback.wrong{background:#fdecea;color:#922b21}
.ex-finish{text-align:center;padding:24px 16px}
.ex-finish-score{font-size:1.25rem;font-weight:700;color:#2c3e50;margin-bottom:14px}
.ex-retry-btn{padding:8px 22px;background:#3498db;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:0.9rem;font-weight:600;font-family:inherit}
.ex-retry-btn:hover{background:#2980b9}

/* Quiz blur */
.lesson-blurrable{transition:filter 0.35s ease,opacity 0.35s ease}
.lesson-blurrable.blurred{filter:blur(6px);opacity:0.45;pointer-events:none;user-select:none}
/* Start quiz banner */
.quiz-start-section{margin-bottom:20px}
.quiz-start-box{background:linear-gradient(135deg,#667eea18,#764ba218);border:2px dashed #764ba240;border-radius:10px;padding:18px 20px;text-align:center}
.quiz-start-title{font-size:0.95rem;font-weight:700;color:#2c3e50;margin-bottom:4px}
.quiz-start-hint{font-size:0.8rem;color:#888;margin-bottom:14px}
.quiz-start-btn{padding:11px 28px;background:#8e44ad;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:0.95rem;font-weight:700;font-family:inherit;transition:background 0.15s,transform 0.1s}
.quiz-start-btn:hover{background:#7d3c98;transform:translateY(-1px)}
.speak-btn{background:none;border:none;cursor:pointer;font-size:0.85rem;padding:0 0 0 5px;opacity:0.5;transition:opacity 0.15s;vertical-align:middle}
.speak-btn:hover{opacity:1}
.speak-btn-char{display:block;margin:2px auto 0;font-size:0.75rem}
.ex-listen-btn{padding:14px 28px;background:#2980b9;color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:1.3rem;font-family:inherit;transition:background 0.15s,transform 0.1s}
.ex-listen-btn:hover{background:#2471a3;transform:scale(1.05)}
/* Review mode */
.review-wrap{max-width:500px;margin:0 auto;padding:8px}
.review-progress{text-align:center;font-size:0.85rem;color:#999;margin-bottom:12px}
.review-card{background:#fff;border-radius:14px;box-shadow:0 3px 16px rgba(0,0,0,0.1);padding:32px 24px;text-align:center;cursor:pointer;min-height:160px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;transition:box-shadow 0.2s}
.review-card:hover{box-shadow:0 4px 20px rgba(0,0,0,0.15)}
.review-card-type{font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:#bbb;margin-bottom:4px}
.review-card-front{font-size:2.8rem;font-weight:700;color:#2c3e50;line-height:1.1}
.review-card-back{margin-top:8px}
.review-reading{font-size:1.2rem;color:#888;margin-bottom:4px}
.review-meaning{font-size:1.5rem;font-weight:700;color:#27ae60}
.review-card-hint{font-size:0.85rem;color:#bbb;font-style:italic}
.review-flip-hint{text-align:center;font-size:0.78rem;color:#ccc;margin-top:8px}
.review-btns{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:14px}
.review-btn{padding:12px 8px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:0.88rem;font-family:inherit;transition:opacity 0.15s,transform 0.1s}
.review-btn:hover{opacity:0.85;transform:translateY(-1px)}
.review-btn.again{background:#e74c3c;color:#fff}
.review-btn.hard{background:#e67e22;color:#fff}
.review-btn.good{background:#27ae60;color:#fff}
.review-btn.easy{background:#2980b9;color:#fff}
.review-empty{text-align:center;padding:60px 20px;background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08)}
.review-empty-icon{font-size:3rem;margin-bottom:12px}
.review-empty-title{font-size:1.3rem;font-weight:700;color:#2c3e50;margin-bottom:6px}
.review-empty-sub{font-size:0.9rem;color:#888}
/* TTS speak button */
.speak-btn{background:none;border:none;cursor:pointer;font-size:0.9rem;opacity:0.5;padding:0 0 0 6px;vertical-align:middle;transition:opacity 0.15s}
.speak-btn:hover{opacity:1}
/* Review view */
.review-wrap{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);padding:24px;max-width:480px;margin:0 auto}
.review-progress{text-align:center;font-size:0.8rem;color:#aaa;margin-bottom:16px}
.review-card{background:linear-gradient(135deg,#f8f9fa,#fff);border:2px solid #e8e8e8;border-radius:14px;padding:32px 24px;text-align:center;cursor:pointer;min-height:180px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;transition:border-color 0.2s}
.review-card:hover{border-color:#ccc}
.review-char{font-size:3.5rem;font-weight:700;color:#2c3e50;line-height:1}
.review-speak{background:none;border:none;font-size:1.4rem;cursor:pointer;opacity:0.6;padding:0;transition:opacity 0.15s}
.review-speak:hover{opacity:1}
.review-tap{font-size:0.8rem;color:#bbb;margin-top:8px}
.review-back{border-top:1px solid #eee;padding-top:14px;width:100%}
.review-answer{font-size:1.4rem;font-weight:600;color:#27ae60;margin-bottom:4px}
.review-reading{font-size:0.9rem;color:#888}
.review-btns{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:16px}
.review-btn{padding:12px;border:none;border-radius:8px;cursor:pointer;font-size:0.9rem;font-weight:700;font-family:inherit;transition:opacity 0.15s}
.review-btn:hover{opacity:0.85}
.review-btn.again{background:#e74c3c;color:#fff}
.review-btn.good{background:#27ae60;color:#fff}
.review-btn.easy{background:#3498db;color:#fff}
.review-done{text-align:center;padding:40px 20px}
.review-done-icon{font-size:3rem;margin-bottom:12px}
.review-done-title{font-size:1.3rem;font-weight:700;color:#2c3e50;margin-bottom:6px}
.review-done-sub{font-size:0.9rem;color:#888}
.view-btn .badge{display:inline-block;background:#e74c3c;color:#fff;border-radius:10px;padding:1px 6px;font-size:0.7rem;font-weight:700;margin-left:4px;vertical-align:middle}
/* Furigana (ruby annotation) */
ruby{display:ruby}
rt{font-size:0.6em;color:#8e44ad;font-weight:400;letter-spacing:0.02em}
.vocab-table td:first-child ruby{font-size:1.1rem}
.vocab-table td:first-child rt{font-size:0.6em}
.furigana-hidden rt{display:none}

/* Level selector overlay */
.level-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;display:flex;align-items:center;justify-content:center}
.level-modal{background:#fff;border-radius:16px;padding:40px 32px;max-width:520px;width:90%;text-align:center;box-shadow:0 8px 40px rgba(0,0,0,0.3)}
.level-modal h2{font-size:1.8rem;font-weight:800;color:#2c3e50;margin-bottom:8px}
.level-modal p{color:#888;font-size:0.95rem;margin-bottom:28px;line-height:1.5}
.level-cards{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
.level-card{border:2px solid #e0e0e0;border-radius:12px;padding:20px 16px;cursor:pointer;transition:all 0.2s;text-align:left}
.level-card:hover{border-color:#3498db;background:#f0f8ff}
.level-card.selected{border-color:#3498db;background:#e8f4fd}
.level-card-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:0.8rem;font-weight:700;color:#fff;margin-bottom:10px}
.level-card h3{font-size:1.1rem;font-weight:700;color:#2c3e50;margin-bottom:4px}
.level-card p{color:#888;font-size:0.8rem;margin-bottom:0}
.level-start-btn{padding:14px 40px;background:#2c3e50;color:#fff;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;font-family:inherit;transition:background 0.2s}
.level-start-btn:hover{background:#1a252f}
.level-continue-btn{background:none;border:none;color:#aaa;font-size:0.85rem;cursor:pointer;margin-top:12px;text-decoration:underline;font-family:inherit}

/* Level badge in header */
.level-badge{padding:4px 10px;border-radius:20px;font-size:0.78rem;font-weight:700;color:#fff;cursor:pointer;border:none;transition:opacity 0.15s}
.level-badge:hover{opacity:0.8}

/* Conjugation exercise */
.ex-conjugation-base{font-size:1.8rem;font-weight:700;color:#2c3e50;text-align:center;margin-bottom:8px}
.ex-conjugation-form{font-size:0.85rem;color:#8e44ad;font-weight:600;text-align:center;margin-bottom:16px}

/* Fill-in-the-blank exercise */
.fitb-sentence{font-size:1.1rem;line-height:1.8;color:#2c3e50;text-align:center;margin-bottom:16px;padding:12px;background:#f8f9fa;border-radius:8px}
.fitb-blank{display:inline-block;min-width:80px;border-bottom:2px solid #3498db;text-align:center;padding:0 8px}
.fitb-hint{font-size:0.8rem;color:#aaa;font-style:italic;text-align:center;margin-bottom:12px}

/* Reading comprehension */
.reading-passage{background:#fafafa;border:1px solid #e8e8e8;border-radius:8px;padding:14px 16px;font-size:1rem;line-height:2;color:#2c3e50;margin-bottom:16px;max-height:200px;overflow-y:auto}
.reading-passage-toggle{font-size:0.78rem;color:#3498db;background:none;border:none;cursor:pointer;padding:0;font-family:inherit;margin-bottom:10px}

/* Stroke order */
.stroke-order-section{margin-top:8px;text-align:center}
.stroke-order-toggle{background:none;border:1px solid #e0e0e0;border-radius:6px;padding:4px 10px;font-size:0.78rem;color:#666;cursor:pointer;font-family:inherit;transition:all 0.15s}
.stroke-order-toggle:hover{background:#f0f0f0;border-color:#ccc}
.stroke-order-img{display:block;margin:8px auto 0;border-radius:6px;border:1px solid #eee;background:#fff}

/* Furigana toggle button */
.furigana-toggle-btn{padding:5px 12px;border:1px solid rgba(255,255,255,0.3);background:transparent;color:#fff;border-radius:4px;cursor:pointer;font-size:0.78rem;transition:background 0.2s;white-space:nowrap}
.furigana-toggle-btn:hover{background:rgba(255,255,255,0.15)}

/* Mock JLPT test mode */
.mock-test-overlay{position:fixed;inset:0;background:#1a1a2e;z-index:900;display:flex;flex-direction:column}
.mock-test-header{background:#16213e;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;color:#fff}
.mock-test-header h2{font-size:1.1rem;font-weight:700}
.mock-test-timer{font-size:1.4rem;font-weight:800;color:#e74c3c;font-variant-numeric:tabular-nums}
.mock-test-timer.warning{animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.mock-test-body{flex:1;overflow-y:auto;padding:24px;max-width:700px;margin:0 auto;width:100%}
.mock-test-q{background:#fff;border-radius:10px;padding:20px;margin-bottom:16px}
.mock-test-q-num{font-size:0.75rem;font-weight:700;color:#999;text-transform:uppercase;margin-bottom:8px}
.mock-test-q-text{font-size:1rem;color:#2c3e50;margin-bottom:14px;line-height:1.6}
.mock-test-options{display:grid;gap:8px}
.mock-test-option{padding:10px 14px;border:2px solid #e0e0e0;background:#fafafa;border-radius:8px;cursor:pointer;text-align:left;font-size:0.95rem;font-family:inherit;transition:border-color 0.15s}
.mock-test-option:hover{border-color:#3498db;background:#f0f8ff}
.mock-test-option.selected{border-color:#3498db;background:#e8f4fd}
.mock-test-option.correct{border-color:#27ae60!important;background:#eafaf1!important;color:#196f3d}
.mock-test-option.wrong{border-color:#e74c3c!important;background:#fdecea!important;color:#922b21}
.mock-test-footer{background:#16213e;padding:16px 24px;display:flex;gap:12px;justify-content:center}
.mock-test-submit{padding:12px 32px;background:#e74c3c;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:700;cursor:pointer;font-family:inherit;transition:background 0.15s}
.mock-test-submit:hover{background:#c0392b}
.mock-test-exit{padding:12px 24px;background:transparent;color:#aaa;border:1px solid #444;border-radius:8px;font-size:1rem;cursor:pointer;font-family:inherit}
.mock-test-results{text-align:center;padding:40px 20px;color:#fff}
.mock-test-score{font-size:3rem;font-weight:800;margin-bottom:12px}
.mock-test-grade{font-size:1.2rem;color:#aaa;margin-bottom:24px}

/* Progress reset */
.progress-reset-section{border-top:1px solid #f0f0f0;padding:16px 24px;background:#fafafa}
.progress-reset-btn{padding:8px 18px;background:#e74c3c;color:#fff;border:none;border-radius:6px;font-size:0.82rem;font-weight:600;cursor:pointer;font-family:inherit}
.level-complete-banner{background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff;padding:20px 24px;border-radius:12px;text-align:center;margin-bottom:20px}
.level-complete-banner h3{font-size:1.3rem;font-weight:700;margin-bottom:6px}
.level-complete-banner p{font-size:0.9rem;opacity:0.9;margin-bottom:14px}
.level-complete-banner button{padding:10px 28px;background:#fff;color:#27ae60;border:none;border-radius:8px;font-size:0.95rem;font-weight:700;cursor:pointer;font-family:inherit}

</style>
</head>
<body>
<div id="root"></div>
<script src="curriculum.js"></script>
<script src="curriculum-n4.js"></script>
<script src="lib.js"></script>
<script>
"use strict";


// â”€â”€ Progressive UI Translations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// As learning-related words are taught in the curriculum, the UI progressively
// switches from English to Japanese. Each entry has {en, ja, since} where
// `since` is the day number when the Japanese word is first taught.
var UI_STRINGS = {
  // Navigation / header
  day_label:      { en: 'Day',      ja: 'ã ã„',       since: 38  },
  week_label:     { en: 'Week',     ja: 'ã—ã‚…ã†',     since: 39  },
  of_365:         { en: 'of 365',   ja: '/ 365ã«ã¡',  since: 38  },
  view_review:    { en: 'Review',   ja: 'ãµãã—ã‚…ã†', since: 49  },
  // Day status
  mark_complete:   { en: 'âœ“ Mark Complete',   ja: 'âœ“ ã‹ã‚“ã‚Šã‚‡ã†ï¼', since: 203 },
  mark_incomplete: { en: 'âœ• Mark Incomplete', ja: 'âœ• ã¾ã ',         since: 53  },
  complete_badge:  { en: 'âœ“ Complete',         ja: 'âœ“ ã‹ã‚“ã‚Šã‚‡ã†',  since: 203 },
  // Navigation buttons
  nav_prev: { en: 'â† Previous', ja: 'â† ã¾ãˆ',   since: 62  },
  nav_next: { en: 'Next â†’',     ja: 'ã¤ãŽ â†’',   since: 109 },
  // Section labels (inside a lesson)
  section_characters: { en: 'Characters',    ja: 'ã‚‚ã˜',       since: 277 },
  section_vocabulary: { en: 'Vocabulary',    ja: 'ãŸã‚“ã”',     since: 140 },
  section_grammar:    { en: 'Grammar Point', ja: 'ã¶ã‚“ã½ã†',   since: 183 },
  section_practice:   { en: 'Practice',      ja: 'ã‚Œã‚“ã—ã‚…ã†', since: 147 },
  section_exercises:  { en: 'Exercises',     ja: 'ã‚‚ã‚“ã ã„',   since: 212 },
  // Vocabulary table headers
  vocab_word:    { en: 'Word',    ja: 'ã“ã¨ã°', since: 139 },
  vocab_reading: { en: 'Reading', ja: 'ã‚ˆã¿',   since: 58  },
  vocab_meaning: { en: 'Meaning', ja: 'ã„ã¿',   since: 137 },
  // SRS review buttons
  btn_again: { en: 'Again', ja: 'ã‚‚ã†ã„ã¡ã©',  since: 47  },
  btn_hard:  { en: 'Hard',  ja: 'ã‚€ãšã‹ã—ã„', since: 77  },
  btn_good:  { en: 'Good',  ja: 'ã„ã„',       since: 44  },
  btn_easy:  { en: 'Easy',  ja: 'ã‹ã‚“ãŸã‚“',   since: 156 },
  // Review card labels
  card_char:    { en: 'Character',  ja: 'ã‚‚ã˜',   since: 277 },
  card_vocab:   { en: 'Vocabulary', ja: 'ãŸã‚“ã”', since: 140 },
  tap_reveal:   { en: 'tap to reveal',                    ja: 'ã‚¿ãƒƒãƒ—ã—ã¦ã¿ã‚‹',  since: 15  },
  click_reveal: { en: 'Click the card to see the answer', ja: 'ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼', since: 46 },
  // Review completion messages
  all_caught_up:  { en: 'All caught up!',      ja: 'ãœã‚“ã¶ãŠã‚ã£ãŸï¼',  since: 179 },
  no_cards_due:   { en: 'No cards due for review right now.', ja: 'ã„ã¾ãµãã—ã‚…ã†ã‚«ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚', since: 49 },
  session_done:   { en: 'Session complete!',   ja: 'ã‚ˆãã§ãã¾ã—ãŸï¼',  since: 140 },
  // Exercise / quiz labels
  start_quiz:  { en: 'Start Quiz',               ja: 'ãƒ†ã‚¹ãƒˆã‚’ã¯ã˜ã‚ã‚‹',     since: 117 },
  try_again:   { en: 'Try Again',                ja: 'ã‚‚ã†ã„ã¡ã©',            since: 47  },
  quiz_title:  { en: 'Ready to test yourself?',  ja: 'ãƒ†ã‚¹ãƒˆã®ã˜ã‹ã‚“ã§ã™ï¼',  since: 117 },
  check_btn:   { en: 'Check',                    ja: 'ã‹ãã«ã‚“',              since: 147 },
  // Exercise prompts (translated once prerequisite words are taught)
  prompt_listen:    { en: 'Listen and choose the meaning:', ja: 'ãã„ã¦ã€ã„ã¿ã‚’ãˆã‚‰ã‚“ã§ãã ã•ã„ï¼š', since: 137 },
  prompt_mc_char:   { en: 'What is the reading for this character?', ja: 'ã“ã®ã‚‚ã˜ã®ã‚ˆã¿ã¯ï¼Ÿ', since: 277 },
  prompt_mc_word:   { en: 'What does this word mean?', ja: 'ã“ã®ã“ã¨ã°ã®ã„ã¿ã¯ï¼Ÿ', since: 137 },
  prompt_type_char: { en: 'Type the reading for this character:', ja: 'ã“ã®ã‚‚ã˜ã®ã‚ˆã¿ã‚’ã«ã‚…ã†ã‚Šã‚‡ãã—ã¦ãã ã•ã„ï¼š', since: 277 },
  prompt_type_word: { en: 'What does this word mean? (type in English)', ja: 'ã“ã®ã“ã¨ã°ã®ã„ã¿ã¯ï¼Ÿï¼ˆãˆã„ã”ã§ï¼‰', since: 137 },
};
function t(key, dayNum) {
  var s = UI_STRINGS[key];
  if (!s) return key;
  return (dayNum >= s.since) ? s.ja : s.en;
}

// â”€â”€ localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var LS_KEY = 'n5_2025';
function lsLoad() {
  try {
    return JSON.parse(localStorage.getItem(LS_KEY) || '{}');
  } catch (e) {
    return {};
  }
}
function lsSave(data) {
  try {
    localStorage.setItem(LS_KEY, JSON.stringify(data));
  } catch (e) {}
}

// â”€â”€ TTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  var doSpeak = function() {
    var u = new SpeechSynthesisUtterance(text);
    u.lang = 'ja-JP';
    u.rate = 0.85;
    var vs = window.speechSynthesis.getVoices();
    var ja = vs.find(function(v) { return v.lang && v.lang.startsWith('ja'); });
    if (ja) u.voice = ja;
    window.speechSynthesis.speak(u);
  };
  if (window.speechSynthesis.getVoices().length > 0) {
    doSpeak();
  } else {
    window.speechSynthesis.addEventListener('voiceschanged', doSpeak, {once: true});
  }
}



// â”€â”€ ReviewView â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ReviewView(_ref6) {
  var srs = _ref6.srs,
    onUpdate = _ref6.onUpdate,
    dayNum = _ref6.dayNum || 1;
  var dueIds = getDueCards(srs);
  var allItems = dueIds.map(function (id) {
    return cardToItem(id, srs);
  }).filter(Boolean);
  var _React$useState = React.useState(function () {
      return rndShuffle(_toConsumableArray(allItems));
    }),
    _React$useState2 = _slicedToArray(_React$useState, 1),
    queue = _React$useState2[0];
  var _React$useState3 = React.useState(0),
    _React$useState4 = _slicedToArray(_React$useState3, 2),
    cur = _React$useState4[0],
    setCur = _React$useState4[1];
  var _React$useState5 = React.useState(false),
    _React$useState6 = _slicedToArray(_React$useState5, 2),
    flipped = _React$useState6[0],
    setFlipped = _React$useState6[1];
  var _React$useState7 = React.useState({
      right: 0,
      wrong: 0
    }),
    _React$useState8 = _slicedToArray(_React$useState7, 2),
    score = _React$useState8[0],
    setScore = _React$useState8[1];
  if (dueIds.length === 0) {
    return /*#__PURE__*/React.createElement("div", {
      className: "review-wrap"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-done"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-done-icon"
    }, "\uD83C\uDF89"), /*#__PURE__*/React.createElement("div", {
      className: "review-done-title"
    }, t('all_caught_up', dayNum)), /*#__PURE__*/React.createElement("div", {
      className: "review-done-sub"
    }, t('no_cards_due', dayNum))));
  }
  if (cur >= queue.length) {
    return /*#__PURE__*/React.createElement("div", {
      className: "review-wrap"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-done"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-done-icon"
    }, "\u2705"), /*#__PURE__*/React.createElement("div", {
      className: "review-done-title"
    }, t('session_done', dayNum)), /*#__PURE__*/React.createElement("div", {
      className: "review-done-sub"
    }, "\u2713 ", score.right, " correct \xB7 \u2717 ", score.wrong, " again")));
  }
  var item = queue[cur];
  var grade = function grade(g) {
    var updated = sm2Update(srs[item.id], g);
    onUpdate(_objectSpread(_objectSpread({}, srs), {}, _defineProperty({}, item.id, updated)));
    setScore(function (s) {
      return {
        right: s.right + (g >= 3 ? 1 : 0),
        wrong: s.wrong + (g < 3 ? 1 : 0)
      };
    });
    setCur(function (c) {
      return c + 1;
    });
    setFlipped(false);
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "review-wrap"
  }, /*#__PURE__*/React.createElement("div", {
    className: "review-progress"
  }, cur + 1, " / ", queue.length, " cards due"), /*#__PURE__*/React.createElement("div", {
    className: "review-card",
    onClick: function onClick() {
      return setFlipped(true);
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "review-char"
  }, item.front), item.type === 'vocab' && /*#__PURE__*/React.createElement("button", {
    className: "review-speak",
    onClick: function onClick(e) {
      e.stopPropagation();
      speak(item.front);
    }
  }, "\uD83D\uDD0A"), !flipped && /*#__PURE__*/React.createElement("div", {
    className: "review-tap"
  }, t('tap_reveal', dayNum)), flipped && /*#__PURE__*/React.createElement("div", {
    className: "review-back"
  }, /*#__PURE__*/React.createElement("div", {
    className: "review-answer"
  }, item.back), item.reading && /*#__PURE__*/React.createElement("div", {
    className: "review-reading"
  }, item.reading))), flipped ? /*#__PURE__*/React.createElement("div", {
    className: "review-btns"
  }, /*#__PURE__*/React.createElement("button", {
    className: "review-btn again",
    onClick: function onClick() {
      return grade(1);
    }
  }, t('btn_again', dayNum)), /*#__PURE__*/React.createElement("button", {
    className: "review-btn good",
    onClick: function onClick() {
      return grade(3);
    }
  }, t('btn_good', dayNum)), /*#__PURE__*/React.createElement("button", {
    className: "review-btn easy",
    onClick: function onClick() {
      return grade(5);
    }
  }, t('btn_easy', dayNum))) : /*#__PURE__*/React.createElement("div", {
    style: {
      height: '56px'
    }
  }));
}


// Maps exercise prompt strings to UI_STRINGS keys for translation
var PROMPT_KEYS = {
  'Listen and choose the meaning:': 'prompt_listen',
  'What is the reading for this character?': 'prompt_mc_char',
  'What does this word mean?': 'prompt_mc_word',
  'Type the reading for this character:': 'prompt_type_char',
  'What does this word mean? (type in English)': 'prompt_type_word',
};
function translatePrompt(prompt, dayNum) {
  var key = PROMPT_KEYS[prompt];
  if (!key) return prompt;
  return t(key, dayNum);
}

// â”€â”€ TypingTip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var TYPING_NOTES = {
  3: "âš  Exceptions: ã— = 'shi' (not 'si')  Â·  ã™ = 'su'",
  4: "âš  Exceptions: ã¡ = 'chi' (not 'ti')  Â·  ã¤ = 'tsu' (not 'tu')",
  8: "âš  Small forms ã‚ƒã‚…ã‚‡ appear only inside combinations â€” never type them alone",
  10: "âš  ã‚“ before a vowel: type 'nn' to prevent it merging (e.g. 'kinen' = ãã­ã‚“, 'kinnen' stays as ãã‚“ã­ã‚“)",
  11: "Voiced sounds are automatic: just type 'ga' â†’ ãŒ, 'za' â†’ ã–. No need to type the dakuten (ã‚›) yourself.",
  12: "Semi-voiced: 'pa' â†’ ã±. Double consonant ã£: type the consonant twice â€” 'tta' â†’ ã£ãŸ  Â·  'kka' â†’ ã£ã‹",
  13: "Combos: consonant + y + vowel â€” 'kya' â†’ ãã‚ƒ  Â·  'sha' â†’ ã—ã‚ƒ  Â·  'cha' â†’ ã¡ã‚ƒ  Â·  'ja' â†’ ã˜ã‚ƒ",
  14: "ã£ in words: just double the next consonant â€” 'kitte' â†’ ãã£ã¦  Â·  'zasshi' â†’ ã–ã£ã—",
  15: "Same romaji as hiragana â€” just switch your IME to katakana mode (usually F7 key or toggle button)."
};
function TypingTip(_ref8) {
  var lesson = _ref8.lesson;
  if (!lesson.chars || lesson.chars.length === 0) return null;
  var note = TYPING_NOTES[lesson.day];
  var examples = lesson.chars.slice(0, 6).map(function (c) {
    return "'".concat(c[1], "' \u2192 ").concat(c[0]);
  }).join('   ');
  return /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, "\u2328 Typing on a Computer"), /*#__PURE__*/React.createElement("div", {
    className: "typing-tip-box"
  }, /*#__PURE__*/React.createElement("div", {
    className: "typing-examples"
  }, examples), note && /*#__PURE__*/React.createElement("div", {
    className: "typing-note"
  }, note), /*#__PURE__*/React.createElement("div", {
    className: "typing-hint"
  }, "Enable a Japanese IME first \u2014 Windows: Win+Space \xB7 Mac: Ctrl+Space (or globe key). Then type romaji and it converts automatically.")));
}

// â”€â”€ Exercises â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Exercises(_ref9) {
  var lesson = _ref9.lesson,
    onStart = _ref9.onStart,
    onFinish = _ref9.onFinish,
    activeCurriculum = _ref9.activeCurriculum;
  var _React$useState9 = React.useState(function () {
      return buildExercises(lesson, activeCurriculum);
    }),
    _React$useState0 = _slicedToArray(_React$useState9, 2),
    exs = _React$useState0[0],
    setExs = _React$useState0[1];
  var _React$useState1 = React.useState(0),
    _React$useState10 = _slicedToArray(_React$useState1, 2),
    cur = _React$useState10[0],
    setCur = _React$useState10[1];
  var _React$useState11 = React.useState(''),
    _React$useState12 = _slicedToArray(_React$useState11, 2),
    answer = _React$useState12[0],
    setAnswer = _React$useState12[1];
  var _React$useState13 = React.useState(null),
    _React$useState14 = _slicedToArray(_React$useState13, 2),
    selected = _React$useState14[0],
    setSelected = _React$useState14[1];
  var _React$useState15 = React.useState(false),
    _React$useState16 = _slicedToArray(_React$useState15, 2),
    revealed = _React$useState16[0],
    setRevealed = _React$useState16[1];
  var _React$useState17 = React.useState({
      right: 0,
      total: 0
    }),
    _React$useState18 = _slicedToArray(_React$useState17, 2),
    score = _React$useState18[0],
    setScore = _React$useState18[1];
  var _React$useState19 = React.useState(false),
    _React$useState20 = _slicedToArray(_React$useState19, 2),
    done = _React$useState20[0],
    setDone = _React$useState20[1];
  var _React$useState21 = React.useState(false),
    _React$useState22 = _slicedToArray(_React$useState21, 2),
    started = _React$useState22[0],
    setStarted = _React$useState22[1];
  var _React$useStatePS = _slicedToArray(React.useState(true), 2),
    showPassage = _React$useStatePS[0],
    setShowPassage = _React$useStatePS[1];
  var inputRef = React.useRef(null);
  if (exs.length === 0) return null;

  // â”€â”€ Not started: show Start Quiz button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (!started) {
    return /*#__PURE__*/React.createElement("div", {
      className: "quiz-start-section"
    }, /*#__PURE__*/React.createElement("div", {
      className: "quiz-start-box"
    }, /*#__PURE__*/React.createElement("div", {
      className: "quiz-start-title"
    }, t('quiz_title', lesson.day)), /*#__PURE__*/React.createElement("div", {
      className: "quiz-start-hint"
    }, "The lesson content above will be hidden while you answer ", exs.length, " questions."), /*#__PURE__*/React.createElement("button", {
      className: "quiz-start-btn",
      onClick: function onClick() {
        setStarted(true);
        onStart && onStart();
      }
    }, t('start_quiz', lesson.day))));
  }
  var retry = function retry() {
    setExs(buildExercises(lesson, activeCurriculum));
    setCur(0);
    setAnswer('');
    setSelected(null);
    setRevealed(false);
    setScore({
      right: 0,
      total: 0
    });
    setDone(false);
    setStarted(false);
    onFinish && onFinish();
  };
  var advance = function advance(wasRight) {
    setScore(function (s) {
      return {
        right: s.right + (wasRight ? 1 : 0),
        total: s.total + 1
      };
    });
    setTimeout(function () {
      if (cur + 1 >= exs.length) {
        setDone(true);
        onFinish && onFinish();
      } else {
        setCur(function (c) {
          return c + 1;
        });
        setAnswer('');
        setSelected(null);
        setRevealed(false);
        setTimeout(function () {
          return inputRef.current && inputRef.current.focus();
        }, 50);
      }
    }, 1000);
  };
  if (done) {
    var pct = score.right / score.total;
    var emoji = pct === 1 ? 'ðŸŒŸ' : pct >= 0.6 ? 'âœ…' : 'ðŸ“š';
    return /*#__PURE__*/React.createElement("div", {
      className: "section"
    }, /*#__PURE__*/React.createElement("div", {
      className: "section-label"
    }, t('section_exercises', lesson.day)), /*#__PURE__*/React.createElement("div", {
      className: "exercise-box"
    }, /*#__PURE__*/React.createElement("div", {
      className: "ex-finish"
    }, /*#__PURE__*/React.createElement("div", {
      className: "ex-finish-score"
    }, emoji, " ", score.right, " / ", score.total, " correct"), /*#__PURE__*/React.createElement("button", {
      className: "ex-retry-btn",
      onClick: retry
    }, t('try_again', lesson.day)))));
  }
  var ex = exs[cur];
  var progress = "".concat(cur + 1, " / ").concat(exs.length);
  if (ex.type === 'mc' || ex.type === 'listen') {
    return /*#__PURE__*/React.createElement("div", {
      className: "section"
    }, /*#__PURE__*/React.createElement("div", {
      className: "section-label"
    }, t('section_exercises', lesson.day), " ", /*#__PURE__*/React.createElement("span", {
      className: "ex-count"
    }, progress)), /*#__PURE__*/React.createElement("div", {
      className: "exercise-box"
    }, /*#__PURE__*/React.createElement("div", {
      className: "ex-prompt"
    }, translatePrompt(ex.prompt, lesson.day)), ex.type === 'listen' ? /*#__PURE__*/React.createElement("div", {
      className: "ex-question"
    }, /*#__PURE__*/React.createElement("button", {
      className: "ex-listen-btn",
      onClick: function onClick() {
        return speak(ex.audio);
      }
    }, "\uD83D\uDD0A Play")) : ex.question && /*#__PURE__*/React.createElement("div", {
      className: "ex-question"
    }, ex.question), /*#__PURE__*/React.createElement("div", {
      className: "ex-options"
    }, ex.options.map(function (opt, i) {
      var cls = 'ex-option';
      if (selected !== null) {
        if (i === ex.correct) cls += ' correct';else if (i === selected) cls += ' wrong';
      }
      return /*#__PURE__*/React.createElement("button", {
        key: i,
        className: cls,
        disabled: selected !== null,
        onClick: function onClick() {
          setSelected(i);
          advance(i === ex.correct);
        }
      }, opt);
    }))));
  }

  // Reading comprehension exercise
  if (ex.type === 'reading') {
    return /*#__PURE__*/React.createElement("div", {className: "section"},
      /*#__PURE__*/React.createElement("div", {className: "section-label"}, t('section_exercises', lesson.day), " ", /*#__PURE__*/React.createElement("span", {className: "ex-count"}, progress)),
      /*#__PURE__*/React.createElement("div", {className: "exercise-box"},
        /*#__PURE__*/React.createElement("div", {className: "ex-prompt"}, ex.prompt),
        showPassage && /*#__PURE__*/React.createElement("div", {className: "reading-passage"}, ex.passage),
        /*#__PURE__*/React.createElement("button", {className: "reading-passage-toggle", onClick: function() { setShowPassage(function(s) { return !s; }); }},
          showPassage ? "Hide passage" : "Show passage"),
        ex.question && /*#__PURE__*/React.createElement("div", {className: "ex-question", style: {fontSize: '1rem', marginTop: '12px'}}, ex.question),
        /*#__PURE__*/React.createElement("div", {className: "ex-options"},
          ex.options.map(function(opt, i) {
            var cls = 'ex-option';
            if (selected !== null) {
              if (i === ex.correct) cls += ' correct'; else if (i === selected) cls += ' wrong';
            }
            return /*#__PURE__*/React.createElement("button", {
              key: i, className: cls, disabled: selected !== null,
              onClick: function() { setSelected(i); advance(i === ex.correct); }
            }, opt);
          })
        )
      )
    );
  }

  // Fill-in-the-blank exercise
  if (ex.type === 'fitb') {
    var handleFitbCheck = function() {
      if (!answer.trim() || revealed) return;
      setRevealed(true);
      advance(checkTyping(answer, ex.answers));
    };
    var fitbRight = revealed && checkTyping(answer, ex.answers);
    return /*#__PURE__*/React.createElement("div", {className: "section"},
      /*#__PURE__*/React.createElement("div", {className: "section-label"}, t('section_exercises', lesson.day), " ", /*#__PURE__*/React.createElement("span", {className: "ex-count"}, progress)),
      /*#__PURE__*/React.createElement("div", {className: "exercise-box"},
        /*#__PURE__*/React.createElement("div", {className: "ex-prompt"}, ex.prompt),
        /*#__PURE__*/React.createElement("div", {className: "fitb-sentence"}, ex.sentence),
        ex.hint && /*#__PURE__*/React.createElement("div", {className: "fitb-hint"}, "Hint: ", ex.hint),
        /*#__PURE__*/React.createElement("div", {className: "ex-typing-row"},
          /*#__PURE__*/React.createElement("input", {
            ref: inputRef, className: "ex-input", type: "text",
            value: answer, onChange: function(e) { setAnswer(e.target.value); },
            onKeyDown: function(e) { if (e.key === 'Enter') handleFitbCheck(); },
            placeholder: "Fill in the blank...", disabled: revealed, autoFocus: true
          }),
          /*#__PURE__*/React.createElement("button", {
            className: "ex-check-btn", onClick: handleFitbCheck, disabled: !answer.trim() || revealed
          }, t('check_btn', lesson.day))
        ),
        revealed && /*#__PURE__*/React.createElement("div", {className: "ex-feedback " + (fitbRight ? 'correct' : 'wrong')},
          fitbRight ? "\u2713 Correct!" : "\u2717  Answer: " + ex.answers[0]
        )
      )
    );
  }

  // Typing / conjugation exercise (shared UI)
  var handleCheck = function handleCheck() {
    if (!answer.trim() || revealed) return;
    setRevealed(true);
    advance(checkTyping(answer, ex.answers));
  };
  var isRight = revealed && checkTyping(answer, ex.answers);
  return /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, t('section_exercises', lesson.day), " ", /*#__PURE__*/React.createElement("span", {
    className: "ex-count"
  }, progress)), /*#__PURE__*/React.createElement("div", {
    className: "exercise-box"
  }, /*#__PURE__*/React.createElement("div", {
    className: "ex-prompt"
  }, translatePrompt(ex.prompt, lesson.day)),
  ex.type === 'conjugation' && /*#__PURE__*/React.createElement("div", null,
    /*#__PURE__*/React.createElement("div", {className: "ex-conjugation-base"}, ex.question),
    /*#__PURE__*/React.createElement("div", {className: "ex-conjugation-form"}, "â†’ " + (ex.prompt.replace('Conjugate to ', '').replace(':', '')))
  ),
  ex.type !== 'conjugation' && ex.question && /*#__PURE__*/React.createElement("div", {
    className: "ex-question"
  }, ex.question), /*#__PURE__*/React.createElement("div", {
    className: "ex-typing-row"
  }, /*#__PURE__*/React.createElement("input", {
    ref: inputRef,
    className: "ex-input",
    type: "text",
    value: answer,
    onChange: function onChange(e) {
      return setAnswer(e.target.value);
    },
    onKeyDown: function onKeyDown(e) {
      if (e.key === 'Enter') handleCheck();
    },
    placeholder: ex.placeholder || 'Type your answer...',
    disabled: revealed,
    autoFocus: true
  }), /*#__PURE__*/React.createElement("button", {
    className: "ex-check-btn",
    onClick: handleCheck,
    disabled: !answer.trim() || revealed
  }, t('check_btn', lesson.day))), revealed && /*#__PURE__*/React.createElement("div", {
    className: "ex-feedback ".concat(isRight ? 'correct' : 'wrong')
  }, isRight ? 'âœ“ Correct!' : "\u2717  Answer: ".concat(ex.answers[0]))));
}


// â”€â”€ Level selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LevelSelector(_ref_ls) {
  var onSelect = _ref_ls.onSelect, hasSaved = _ref_ls.hasSaved;
  var _ls = _slicedToArray(React.useState('n5'), 2),
    selLevel = _ls[0],
    setSelLevel = _ls[1];
  return /*#__PURE__*/React.createElement("div", {className: "level-overlay"},
    /*#__PURE__*/React.createElement("div", {className: "level-modal"},
      /*#__PURE__*/React.createElement("h2", null, "\u65E5\u672C\u8A9E Course"),
      /*#__PURE__*/React.createElement("p", null, "Choose your level to begin. You can switch levels any time from the header."),
      /*#__PURE__*/React.createElement("div", {className: "level-cards"},
        /*#__PURE__*/React.createElement("div", {
          className: "level-card " + (selLevel === 'n5' ? 'selected' : ''),
          onClick: function() { setSelLevel('n5'); }
        },
          /*#__PURE__*/React.createElement("span", {className: "level-card-badge", style: {background: '#2980b9'}}, "N5"),
          /*#__PURE__*/React.createElement("h3", null, "JLPT N5"),
          /*#__PURE__*/React.createElement("p", null, "Beginner \u2014 hiragana, katakana, ~800 words, ~100 kanji. Start here if you\u2019re new to Japanese.")
        ),
        /*#__PURE__*/React.createElement("div", {
          className: "level-card " + (selLevel === 'n4' ? 'selected' : ''),
          onClick: function() { setSelLevel('n4'); }
        },
          /*#__PURE__*/React.createElement("span", {className: "level-card-badge", style: {background: '#e74c3c'}}, "N4"),
          /*#__PURE__*/React.createElement("h3", null, "JLPT N4"),
          /*#__PURE__*/React.createElement("p", null, "Elementary \u2014 ~1,500 words, ~300 kanji. Choose this if you\u2019ve completed N5.")
        )
      ),
      /*#__PURE__*/React.createElement("button", {
        className: "level-start-btn",
        onClick: function() { onSelect(selLevel); }
      }, "Start " + selLevel.toUpperCase() + " Course"),
      hasSaved && /*#__PURE__*/React.createElement("div", null,
        /*#__PURE__*/React.createElement("button", {
          className: "level-continue-btn",
          onClick: function() { onSelect(null); }
        }, "Continue where I left off")
      )
    )
  );
}

// â”€â”€ Mock JLPT Test Mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MockTest(_ref_mt) {
  var activeCurriculum = _ref_mt.activeCurriculum, level = _ref_mt.level, onExit = _ref_mt.onExit;
  var DURATION = 30 * 60; // 30 minutes
  var _mt1 = React.useState(function() {
    // Build 20 questions from random lessons
    var allVocab = activeCurriculum.flatMap(function(d) { return d.vocab || []; });
    var allConj = activeCurriculum.flatMap(function(d) { return (d.conjugations || []); });
    var questions = [];
    // Vocab MC questions
    var vocabPool = rndShuffle(allVocab.filter(function(v) { return v[2] && v[2].trim(); })).slice(0, 12);
    vocabPool.forEach(function(v) {
      var wrong = rndShuffle(allVocab.filter(function(w) { return w[2] !== v[2] && w[2] && w[2].trim(); })).slice(0, 3);
      var opts = rndShuffle([v[2]].concat(wrong.map(function(w) { return w[2]; })));
      questions.push({
        type: 'vocab',
        text: '\u300C' + v[0] + '\u300D means:',
        options: opts,
        correct: opts.indexOf(v[2])
      });
    });
    // Conjugation questions
    if (allConj.length > 0) {
      var conjPool = rndShuffle(allConj).slice(0, 8);
      conjPool.forEach(function(c) {
        var wrong = rndShuffle(allConj.filter(function(x) { return x.answer !== c.answer; })).slice(0, 3);
        var opts = rndShuffle([c.answer].concat(wrong.map(function(x) { return x.answer; })));
        questions.push({
          type: 'conjugation',
          text: c.form + ' of \u300C' + c.base + '\u300D:',
          options: opts,
          correct: opts.indexOf(c.answer)
        });
      });
    }
    return rndShuffle(questions).slice(0, 20);
  }),
    _mt1s = _slicedToArray(_mt1, 2),
    questions = _mt1s[0];

  var _mt2 = React.useState(DURATION), _mt2s = _slicedToArray(_mt2, 2), timeLeft = _mt2s[0], setTimeLeft = _mt2s[1];
  var _mt3 = React.useState({}), _mt3s = _slicedToArray(_mt3, 2), answers = _mt3s[0], setAnswers = _mt3s[1];
  var _mt4 = React.useState(false), _mt4s = _slicedToArray(_mt4, 2), submitted = _mt4s[0], setSubmitted = _mt4s[1];

  React.useEffect(function() {
    if (submitted) return;
    var interval = setInterval(function() {
      setTimeLeft(function(t) {
        if (t <= 1) { setSubmitted(true); return 0; }
        return t - 1;
      });
    }, 1000);
    return function() { clearInterval(interval); };
  }, [submitted]);

  var formatTime = function(s) {
    var m = Math.floor(s / 60);
    var sec = s % 60;
    return (m < 10 ? '0' : '') + m + ':' + (sec < 10 ? '0' : '') + sec;
  };

  var score = submitted ? questions.reduce(function(acc, q, i) {
    return acc + (answers[i] === q.correct ? 1 : 0);
  }, 0) : 0;

  var pct = submitted ? Math.round(score / questions.length * 100) : 0;

  if (submitted) {
    return /*#__PURE__*/React.createElement("div", {className: "mock-test-overlay"},
      /*#__PURE__*/React.createElement("div", {className: "mock-test-header"},
        /*#__PURE__*/React.createElement("h2", null, level.toUpperCase() + " Mock Test \u2014 Results"),
        /*#__PURE__*/React.createElement("button", {className: "mock-test-exit", onClick: onExit}, "Exit")
      ),
      /*#__PURE__*/React.createElement("div", {className: "mock-test-body"},
        /*#__PURE__*/React.createElement("div", {className: "mock-test-results"},
          /*#__PURE__*/React.createElement("div", {className: "mock-test-score", style: {color: pct >= 60 ? '#27ae60' : '#e74c3c'}},
            score + " / " + questions.length
          ),
          /*#__PURE__*/React.createElement("div", {className: "mock-test-grade"},
            pct >= 80 ? "\uD83C\uDF1F Excellent! (" + pct + "%)" :
            pct >= 60 ? "\u2705 Pass (" + pct + "%)" :
            "\uD83D\uDCDA Keep studying (" + pct + "%)"
          )
        ),
        questions.map(function(q, i) {
          return /*#__PURE__*/React.createElement("div", {key: i, className: "mock-test-q"},
            /*#__PURE__*/React.createElement("div", {className: "mock-test-q-num"}, "Q" + (i+1)),
            /*#__PURE__*/React.createElement("div", {className: "mock-test-q-text"}, q.text),
            /*#__PURE__*/React.createElement("div", {className: "mock-test-options"},
              q.options.map(function(opt, j) {
                var cls = "mock-test-option";
                if (j === q.correct) cls += " correct";
                else if (answers[i] === j) cls += " wrong";
                return /*#__PURE__*/React.createElement("button", {key: j, className: cls, disabled: true}, opt);
              })
            )
          );
        })
      )
    );
  }

  return /*#__PURE__*/React.createElement("div", {className: "mock-test-overlay"},
    /*#__PURE__*/React.createElement("div", {className: "mock-test-header"},
      /*#__PURE__*/React.createElement("h2", null, level.toUpperCase() + " Mock Test \u2014 " + questions.length + " questions"),
      /*#__PURE__*/React.createElement("div", {className: "mock-test-timer " + (timeLeft < 300 ? 'warning' : '')}, formatTime(timeLeft)),
      /*#__PURE__*/React.createElement("button", {className: "mock-test-exit", onClick: onExit}, "Exit")
    ),
    /*#__PURE__*/React.createElement("div", {className: "mock-test-body"},
      questions.map(function(q, i) {
        return /*#__PURE__*/React.createElement("div", {key: i, className: "mock-test-q"},
          /*#__PURE__*/React.createElement("div", {className: "mock-test-q-num"}, "Q" + (i+1)),
          /*#__PURE__*/React.createElement("div", {className: "mock-test-q-text"}, q.text),
          /*#__PURE__*/React.createElement("div", {className: "mock-test-options"},
            q.options.map(function(opt, j) {
              return /*#__PURE__*/React.createElement("button", {
                key: j,
                className: "mock-test-option " + (answers[i] === j ? 'selected' : ''),
                onClick: function() { setAnswers(function(a) { var n = Object.assign({}, a); n[i] = j; return n; }); }
              }, opt);
            })
          )
        );
      })
    ),
    /*#__PURE__*/React.createElement("div", {className: "mock-test-footer"},
      /*#__PURE__*/React.createElement("button", {
        className: "mock-test-submit",
        onClick: function() { setSubmitted(true); }
      }, "Submit Test"),
      /*#__PURE__*/React.createElement("button", {className: "mock-test-exit", onClick: onExit}, "Exit without submitting")
    )
  );
}

function App() {
  // â”€â”€ Level state â”€â”€
  var _lsLevel = (function() { try { return localStorage.getItem('jlpt_level') || null; } catch(e) { return null; } })();
  var _hasSaved = (function() { try { return !!(localStorage.getItem('n5_day') || localStorage.getItem('n4_day')); } catch(e) { return false; } })();
  var _React$useState_level = React.useState(_lsLevel),
    _React$useState_levels = _slicedToArray(_React$useState_level, 2),
    level = _React$useState_levels[0],
    setLevel = _React$useState_levels[1];

  var _React$useState_showLevelSel = React.useState(!_lsLevel),
    _showLevelSelArr = _slicedToArray(_React$useState_showLevelSel, 2),
    showLevelSel = _showLevelSelArr[0],
    setShowLevelSel = _showLevelSelArr[1];

  var _React$useState_furigana = React.useState(true),
    _furiganaArr = _slicedToArray(_React$useState_furigana, 2),
    showFurigana = _furiganaArr[0],
    setShowFurigana = _furiganaArr[1];

  var _React$useState_mockTest = React.useState(false),
    _mockTestArr = _slicedToArray(_React$useState_mockTest, 2),
    showMockTest = _mockTestArr[0],
    setShowMockTest = _mockTestArr[1];

  // active curriculum and phase constants based on level
  var activeLevel = level || 'n5';
  var activeCurriculum = (activeLevel === 'n4' && typeof curriculum_n4 !== 'undefined') ? curriculum_n4 : curriculum;
  var activePhaseCols = activeLevel === 'n4' ? PHASE_COLORS_N4 : PHASE_COLORS;
  var activePhaseBg = activeLevel === 'n4' ? PHASE_BG_N4 : PHASE_BG;
  var activePhaseNames = activeLevel === 'n4' ? PHASE_NAMES_N4 : PHASE_NAMES;
  var totalDays = activeCurriculum.length;

  var _dayLsKey = activeLevel === 'n4' ? 'n4_day' : 'n5_day';
  var _completedLsKey = activeLevel === 'n4' ? 'n4_completed' : 'n5_completed';
  var _srsKey = activeLevel === 'n4' ? 'n4_srs' : 'n5_srs';

  var _React$useState23 = React.useState(function () {
      try {
        return parseInt(localStorage.getItem(_dayLsKey) || '1') || 1;
      } catch (e) {
        return 1;
      }
    }),
    _React$useState24 = _slicedToArray(_React$useState23, 2),
    dayNum = _React$useState24[0],
    setDayNum = _React$useState24[1];
  var _React$useState25 = React.useState(function () {
      try {
        var raw = localStorage.getItem(_srsKey);
        return raw ? JSON.parse(raw) : {};
      } catch(e) { return {}; }
    }),
    _React$useState26 = _slicedToArray(_React$useState25, 2),
    srsCards = _React$useState26[0],
    setSrsCards = _React$useState26[1];

  var _React$useState27 = React.useState(function () {
    try { return new Set(JSON.parse(localStorage.getItem(_completedLsKey) || '[]')); }
    catch (e) { return new Set(); }
  }),
    _React$useState28 = _slicedToArray(_React$useState27, 2),
    completed = _React$useState28[0],
    setCompleted = _React$useState28[1];

  var _React$useState29 = React.useState('day'),
    _React$useState30 = _slicedToArray(_React$useState29, 2),
    view = _React$useState30[0],
    setView = _React$useState30[1];

  var safeDayNum = Math.max(1, Math.min(dayNum, totalDays));
  var lesson = activeCurriculum[safeDayNum - 1];
  var pColor = (activePhaseCols[lesson.phaseNum]) || '#555';
  var pBg = (activePhaseBg[lesson.phaseNum]) || '#f8f9fa';
  var pct = Math.round(completed.size / totalDays * 100);

  var handleLevelSelect = function(newLevel) {
    if (!newLevel) { setShowLevelSel(false); return; }
    try { localStorage.setItem('jlpt_level', newLevel); } catch(e) {}
    setLevel(newLevel);
    setShowLevelSel(false);
    // Reset day to 1 when switching levels
    var newDayKey = newLevel === 'n4' ? 'n4_day' : 'n5_day';
    var savedDay = parseInt(localStorage.getItem(newDayKey) || '1') || 1;
    setDayNum(savedDay);
    var newCompKey = newLevel === 'n4' ? 'n4_completed' : 'n5_completed';
    try {
      var saved = new Set(JSON.parse(localStorage.getItem(newCompKey) || '[]'));
      setCompleted(saved);
    } catch(e) { setCompleted(new Set()); }
    var newSrsKey = newLevel === 'n4' ? 'n4_srs' : 'n5_srs';
    try {
      var savedSrs = JSON.parse(localStorage.getItem(newSrsKey) || '{}');
      setSrsCards(savedSrs);
    } catch(e) { setSrsCards({}); }
  };

  var toggleDone = function toggleDone() {
    var wasDone = completed.has(safeDayNum);
    setCompleted(function (prev) {
      var n = new Set(prev);
      n.has(safeDayNum) ? n["delete"](safeDayNum) : n.add(safeDayNum);
      return n;
    });
    setSrsCards(function (prev) {
      var cards = Object.assign({}, prev);
      if (wasDone) {
        var prefix1 = 'v_' + safeDayNum + '_';
        var prefix2 = 'c_' + safeDayNum + '_';
        Object.keys(cards).forEach(function (id) {
          if (id.startsWith(prefix1) || id.startsWith(prefix2)) {
            delete cards[id];
          }
        });
      } else {
        srsAddCards(lesson, cards);
      }
      try { localStorage.setItem(_srsKey, JSON.stringify(cards)); } catch(e) {}
      return cards;
    });
  };

  React.useEffect(function () {
    try { localStorage.setItem(_dayLsKey, String(safeDayNum)); } catch (e) {}
  }, [safeDayNum, activeLevel]);
  React.useEffect(function () {
    try { localStorage.setItem(_completedLsKey, JSON.stringify(_toConsumableArray(completed))); } catch (e) {}
  }, [completed, activeLevel]);

  var levelColor = activeLevel === 'n4' ? '#e74c3c' : '#2980b9';
  var dueCount = srsDueCards(srsCards).length;

  var isN5Complete = activeLevel === 'n5' && completed.size >= 365;

  return /*#__PURE__*/React.createElement("div", {
    className: "app " + (showFurigana ? '' : 'furigana-hidden')
  },
  showLevelSel && /*#__PURE__*/React.createElement(LevelSelector, {
    onSelect: handleLevelSelect,
    hasSaved: _hasSaved
  }),
  showMockTest && /*#__PURE__*/React.createElement(MockTest, {
    activeCurriculum: activeCurriculum,
    level: activeLevel,
    onExit: function() { setShowMockTest(false); }
  }),
  /*#__PURE__*/React.createElement("header", {
    className: "header"
  }, /*#__PURE__*/React.createElement("h1", null, "\u65E5\u672C\u8A9E | 365-Day Course"), /*#__PURE__*/React.createElement("div", {
    className: "header-right"
  }, /*#__PURE__*/React.createElement("button", {
    className: "level-badge",
    style: {background: levelColor},
    onClick: function() { setShowLevelSel(true); },
    title: "Switch level"
  }, activeLevel.toUpperCase()),
  /*#__PURE__*/React.createElement("button", {
    className: "furigana-toggle-btn",
    onClick: function() { setShowFurigana(function(f) { return !f; }); },
    title: "Toggle furigana"
  }, showFurigana ? "ãµã‚ŠãŒãª ON" : "ãµã‚ŠãŒãª OFF"),
  /*#__PURE__*/React.createElement("div", {
    className: "progress-wrap"
  }, /*#__PURE__*/React.createElement("div", {
    className: "progress-bar"
  }, /*#__PURE__*/React.createElement("div", {
    className: "progress-fill",
    style: {
      width: pct + '%'
    }
  })), /*#__PURE__*/React.createElement("span", null, completed.size, " / ", totalDays)), /*#__PURE__*/React.createElement("div", {
    className: "view-btns"
  }, /*#__PURE__*/React.createElement("button", {
    className: "view-btn ".concat(view === 'day' ? 'active' : ''),
    onClick: function onClick() {
      return setView('day');
    }
  }, "Day View"), /*#__PURE__*/React.createElement("button", {
    className: "view-btn ".concat(view === 'overview' ? 'active' : ''),
    onClick: function onClick() {
      return setView('overview');
    }
  }, "Overview"), /*#__PURE__*/React.createElement("button", {
    className: "view-btn ".concat(view === 'review' ? 'active' : ''),
    onClick: function onClick() {
      return setView('review');
    }
  }, t('view_review', safeDayNum), dueCount > 0 ? " (".concat(dueCount, ")") : ''),
  /*#__PURE__*/React.createElement("button", {
    className: "view-btn",
    onClick: function() { setShowMockTest(true); },
    title: "Mock JLPT test"
  }, "Mock Test")))),
  /*#__PURE__*/React.createElement("main", {
    className: "main"
  },
  isN5Complete && /*#__PURE__*/React.createElement("div", {className: "level-complete-banner"},
    /*#__PURE__*/React.createElement("h3", null, "\uD83C\uDF89 N5 Complete!"),
    /*#__PURE__*/React.createElement("p", null, "You\u2019ve finished all 365 N5 days. Ready to start N4?"),
    /*#__PURE__*/React.createElement("button", {onClick: function() { handleLevelSelect('n4'); }}, "Start N4 Course")
  ),
  view === 'review' ? /*#__PURE__*/React.createElement(ReviewMode, {
    cards: srsCards,
    dayNum: safeDayNum,
    onUpdate: function onUpdate(updated) {
      setSrsCards(updated);
      try { localStorage.setItem(_srsKey, JSON.stringify(updated)); } catch(e) {}
    }
  }) : view === 'overview' ? /*#__PURE__*/React.createElement(Overview, {
    curriculum: activeCurriculum,
    phaseColors: activePhaseCols,
    phaseNames: activePhaseNames,
    completed: completed,
    dayNum: safeDayNum,
    setDay: function setDay(d) {
      setDayNum(d);
      setView('day');
    },
    currentDay: safeDayNum
  }) : /*#__PURE__*/React.createElement(DayView, {
    lesson: lesson,
    dayNum: safeDayNum,
    pColor: pColor,
    pBg: pBg,
    completed: completed,
    toggleDone: toggleDone,
    setDay: setDayNum,
    totalDays: totalDays,
    activeCurriculum: activeCurriculum
  })));
}
// â”€â”€ KanjiVG stroke order helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kanjiCodepoint(ch) {
  return ch.codePointAt(0).toString(16).padStart(5, '0');
}
function StrokeOrderCard(_ref_so) {
  var kanji = _ref_so.kanji;
  var _so = React.useState(false), _sos = _slicedToArray(_so, 2), show = _sos[0], setShow = _sos[1];
  var cp = kanjiCodepoint(kanji);
  // KanjiVG SVGs via jsDelivr CDN (no local files needed)
  var src = 'https://cdn.jsdelivr.net/npm/kanjivg@1.0.0/svg/' + cp + '.svg';
  return /*#__PURE__*/React.createElement("div", {className: "stroke-order-section"},
    /*#__PURE__*/React.createElement("button", {
      className: "stroke-order-toggle",
      onClick: function() { setShow(function(s) { return !s; }); }
    }, show ? "Hide stroke order" : "Show stroke order"),
    show && /*#__PURE__*/React.createElement("img", {
      className: "stroke-order-img",
      src: src,
      alt: "Stroke order for " + kanji,
      width: 100,
      height: 100,
      onError: function(e) { e.target.style.display='none'; }
    })
  );
}

function DayView(_ref0) {
  var lesson = _ref0.lesson,
    dayNum = _ref0.dayNum,
    pColor = _ref0.pColor,
    pBg = _ref0.pBg,
    completed = _ref0.completed,
    toggleDone = _ref0.toggleDone,
    setDay = _ref0.setDay,
    totalDays = _ref0.totalDays || 365,
    activeCurriculum = _ref0.activeCurriculum;
  var isDone = completed.has(dayNum);
  var _React$useState31 = React.useState(false),
    _React$useState32 = _slicedToArray(_React$useState31, 2),
    quizActive = _React$useState32[0],
    setQuizActive = _React$useState32[1];
  React.useEffect(function () {
    setQuizActive(false);
  }, [dayNum]);

  // Detect if this is a kanji lesson (for stroke order)
  var isKanjiLesson = lesson.type === 'kanji' || (lesson.chars && lesson.chars.length > 0 && lesson.chars.some(function(c) { return hasKanji(c[0]); }));

  return /*#__PURE__*/React.createElement("div", {
    className: "day-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "day-header",
    style: {
      background: pBg
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "day-meta"
  }, /*#__PURE__*/React.createElement("span", {
    className: "day-num"
  }, t('day_label', dayNum), " ", dayNum), /*#__PURE__*/React.createElement("span", {
    className: "phase-badge",
    style: {
      background: pColor
    }
  }, lesson.phaseName), /*#__PURE__*/React.createElement("span", {
    className: "week-badge"
  }, t('week_label', dayNum), " ", lesson.week), isDone && /*#__PURE__*/React.createElement("span", {
    className: "complete-badge"
  }, t('complete_badge', dayNum))), /*#__PURE__*/React.createElement("h2", {
    className: "day-title"
  }, lesson.title)), /*#__PURE__*/React.createElement("div", {
    className: "day-body"
  }, /*#__PURE__*/React.createElement("div", {
    className: "lesson-blurrable".concat(quizActive ? ' blurred' : '')
  }, lesson.intro && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, "Overview"), /*#__PURE__*/React.createElement("div", {
    className: "intro-text"
  }, lesson.intro)), lesson.chars && lesson.chars.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, t('section_characters', dayNum)), /*#__PURE__*/React.createElement("div", {
    className: "chars-table"
  }, lesson.chars.map(function (c, i) {
    var isKanji = hasKanji(c[0]);
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "char-card"
    }, /*#__PURE__*/React.createElement("span", {
      className: "char-jp"
    }, c[0]), /*#__PURE__*/React.createElement("button", {
      className: "speak-btn speak-btn-char",
      onClick: function onClick() {
        return speak(c[0]);
      },
      title: "Listen"
    }, "\uD83D\uDD0A"), /*#__PURE__*/React.createElement("span", {
      className: "char-reading"
    }, c[1]),
    isKanji && /*#__PURE__*/React.createElement(StrokeOrderCard, {kanji: c[0], key: "so-" + i})
    );
  }))), /*#__PURE__*/React.createElement(TypingTip, {
    lesson: lesson
  }),
  lesson.conjugations && lesson.conjugations.length > 0 && /*#__PURE__*/React.createElement("div", {className: "section"},
    /*#__PURE__*/React.createElement("div", {className: "section-label"}, "Conjugations"),
    /*#__PURE__*/React.createElement("table", {className: "vocab-table"},
      /*#__PURE__*/React.createElement("thead", null,
        /*#__PURE__*/React.createElement("tr", null,
          /*#__PURE__*/React.createElement("th", null, "Base"),
          /*#__PURE__*/React.createElement("th", null, "Form"),
          /*#__PURE__*/React.createElement("th", null, "Conjugated")
        )
      ),
      /*#__PURE__*/React.createElement("tbody", null,
        lesson.conjugations.map(function(conj, i) {
          return /*#__PURE__*/React.createElement("tr", {key: i},
            /*#__PURE__*/React.createElement("td", null, conj.base, /*#__PURE__*/React.createElement("button", {className: "speak-btn", onClick: function() { speak(conj.base); }, title: "Listen"}, "\uD83D\uDD0A")),
            /*#__PURE__*/React.createElement("td", null, conj.form),
            /*#__PURE__*/React.createElement("td", null, conj.answer, /*#__PURE__*/React.createElement("button", {className: "speak-btn", onClick: function() { speak(conj.answer); }, title: "Listen"}, "\uD83D\uDD0A"))
          );
        })
      )
    )
  ),
  lesson.passages && lesson.passages.length > 0 && /*#__PURE__*/React.createElement("div", {className: "section"},
    /*#__PURE__*/React.createElement("div", {className: "section-label"}, "Reading Passages"),
    lesson.passages.map(function(p, pi) {
      return /*#__PURE__*/React.createElement(PassageCard, {key: pi, passage: p});
    })
  ),
  lesson.vocab && lesson.vocab.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, t('section_vocabulary', dayNum)), function () {
    var hasReadings = lesson.vocab.some(function (v) {
      return v[1] && v[1] !== v[0];
    });
    return /*#__PURE__*/React.createElement("table", {
      className: "vocab-table"
    }, hasReadings && /*#__PURE__*/React.createElement("thead", null, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("th", null, t('vocab_word', dayNum)), /*#__PURE__*/React.createElement("th", null, t('vocab_reading', dayNum)), /*#__PURE__*/React.createElement("th", null, t('vocab_meaning', dayNum)))), /*#__PURE__*/React.createElement("tbody", null, lesson.vocab.map(function (v, i) {
      return /*#__PURE__*/React.createElement("tr", {
        key: i
      }, /*#__PURE__*/React.createElement("td", null, hasKanji(v[0]) && v[1] && v[1] !== v[0] ? /*#__PURE__*/React.createElement("ruby", null, v[0], /*#__PURE__*/React.createElement("rt", null, v[1])) : v[0], /*#__PURE__*/React.createElement("button", {
        className: "speak-btn",
        onClick: function onClick() {
          return speak(v[0]);
        },
        title: "Listen"
      }, "\uD83D\uDD0A")), hasReadings && !hasKanji(v[0]) && /*#__PURE__*/React.createElement("td", null, v[1]), hasReadings && hasKanji(v[0]) && /*#__PURE__*/React.createElement("td", null), /*#__PURE__*/React.createElement("td", null, v[2]));
    })));
  }()), lesson.grammar && lesson.grammar.pattern && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, t('section_grammar', dayNum)), /*#__PURE__*/React.createElement("div", {
    className: "grammar-box"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grammar-pattern"
  }, lesson.grammar.pattern), /*#__PURE__*/React.createElement("div", {
    className: "grammar-meaning"
  }, lesson.grammar.meaning), /*#__PURE__*/React.createElement("div", {
    className: "grammar-example"
  }, /*#__PURE__*/React.createElement("div", {
    className: "jp"
  }, lesson.grammar.example_jp), /*#__PURE__*/React.createElement("div", {
    className: "en"
  }, lesson.grammar.example_en)))), lesson.practice && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "section-label"
  }, t('section_practice', dayNum)), /*#__PURE__*/React.createElement("div", {
    className: "practice-box"
  }, lesson.practice)), lesson.tip && /*#__PURE__*/React.createElement("div", {
    className: "section"
  }, /*#__PURE__*/React.createElement("div", {
    className: "tip-box"
  }, lesson.tip))), /*#__PURE__*/React.createElement(Exercises, {
    key: lesson.day,
    lesson: lesson,
    activeCurriculum: activeCurriculum,
    onStart: function onStart() {
      return setQuizActive(true);
    },
    onFinish: function onFinish() {
      return setQuizActive(false);
    }
  })), /*#__PURE__*/React.createElement("div", {
    className: "nav-bar"
  }, /*#__PURE__*/React.createElement("button", {
    className: "nav-btn prev",
    onClick: function onClick() {
      return setDay(Math.max(1, dayNum - 1));
    },
    disabled: dayNum === 1
  }, t('nav_prev', dayNum)), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "day-counter"
  }, t('day_label', dayNum), " ", dayNum, " / ", totalDays), /*#__PURE__*/React.createElement("button", {
    className: "nav-btn complete ".concat(isDone ? 'done' : ''),
    onClick: toggleDone
  }, isDone ? t('mark_incomplete', dayNum) : t('mark_complete', dayNum))), /*#__PURE__*/React.createElement("button", {
    className: "nav-btn next",
    onClick: function onClick() {
      return setDay(Math.min(totalDays, dayNum + 1));
    },
    disabled: dayNum === totalDays
  }, t('nav_next', dayNum))));
}

// â”€â”€ PassageCard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PassageCard(_ref_pc) {
  var passage = _ref_pc.passage;
  var _pc = React.useState(false), _pcs = _slicedToArray(_pc, 2), showEn = _pcs[0], setShowEn = _pcs[1];
  return /*#__PURE__*/React.createElement("div", {style: {marginBottom: '12px'}},
    /*#__PURE__*/React.createElement("div", {className: "reading-passage"}, passage.jp),
    /*#__PURE__*/React.createElement("button", {
      className: "reading-passage-toggle",
      onClick: function() { setShowEn(function(s) { return !s; }); }
    }, showEn ? "Hide translation" : "Show translation"),
    showEn && /*#__PURE__*/React.createElement("div", {className: "intro-text", style: {marginTop: '8px'}}, passage.en)
  );
}
function ReviewMode(_ref1) {
  var cards = _ref1.cards,
    onUpdate = _ref1.onUpdate,
    dayNum = _ref1.dayNum || 1;
  var _React$useStateQ = React.useState(function() { return rndShuffle(srsDueCards(cards)); }),
    _React$useStateQS = _slicedToArray(_React$useStateQ, 2),
    due = _React$useStateQS[0];
  var _React$useState33 = React.useState(0),
    _React$useState34 = _slicedToArray(_React$useState33, 2),
    idx = _React$useState34[0],
    setIdx = _React$useState34[1];
  var _React$useState35 = React.useState(false),
    _React$useState36 = _slicedToArray(_React$useState35, 2),
    flipped = _React$useState36[0],
    setFlipped = _React$useState36[1];
  if (due.length === 0) {
    return /*#__PURE__*/React.createElement("div", {
      className: "review-empty"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-empty-icon"
    }, "\u2705"), /*#__PURE__*/React.createElement("div", {
      className: "review-empty-title"
    }, t('all_caught_up', dayNum)), /*#__PURE__*/React.createElement("div", {
      className: "review-empty-sub"
    }, t('no_cards_due', dayNum)));
  }
  if (idx >= due.length) {
    return /*#__PURE__*/React.createElement("div", {
      className: "review-empty"
    }, /*#__PURE__*/React.createElement("div", {
      className: "review-empty-icon"
    }, "\uD83C\uDF1F"), /*#__PURE__*/React.createElement("div", {
      className: "review-empty-title"
    }, t('session_done', dayNum)), /*#__PURE__*/React.createElement("div", {
      className: "review-empty-sub"
    }, "Reviewed ", due.length, " card", due.length !== 1 ? 's' : '', "."));
  }
  var card = due[idx];
  var rate = function rate(quality) {
    var updated = _objectSpread(_objectSpread({}, cards), {}, _defineProperty({}, card.id, srsReview(card, quality)));
    onUpdate(updated);
    setFlipped(false);
    setIdx(function (i) {
      return i + 1;
    });
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "review-wrap"
  }, /*#__PURE__*/React.createElement("div", {
    className: "review-progress"
  }, idx + 1, " / ", due.length, " due"), /*#__PURE__*/React.createElement("div", {
    className: "review-card",
    onClick: function onClick() {
      return !flipped && setFlipped(true);
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "review-card-type"
  }, card.type === 'char' ? t('card_char', dayNum) : t('card_vocab', dayNum)), /*#__PURE__*/React.createElement("div", {
    className: "review-card-front"
  }, card.front, /*#__PURE__*/React.createElement("button", {
    className: "speak-btn",
    style: {
      fontSize: '1.2rem',
      marginLeft: '8px'
    },
    onClick: function onClick(e) {
      e.stopPropagation();
      speak(card.front);
    }
  }, "\uD83D\uDD0A")), flipped ? /*#__PURE__*/React.createElement("div", {
    className: "review-card-back"
  }, card.reading && card.reading !== card.front && /*#__PURE__*/React.createElement("div", {
    className: "review-reading"
  }, card.reading), /*#__PURE__*/React.createElement("div", {
    className: "review-meaning"
  }, card.back)) : /*#__PURE__*/React.createElement("div", {
    className: "review-card-hint"
  }, t('tap_reveal', dayNum))), flipped && /*#__PURE__*/React.createElement("div", {
    className: "review-btns"
  }, /*#__PURE__*/React.createElement("button", {
    className: "review-btn again",
    onClick: function onClick() {
      return rate(0);
    }
  }, t('btn_again', dayNum)), /*#__PURE__*/React.createElement("button", {
    className: "review-btn hard",
    onClick: function onClick() {
      return rate(1);
    }
  }, t('btn_hard', dayNum)), /*#__PURE__*/React.createElement("button", {
    className: "review-btn good",
    onClick: function onClick() {
      return rate(2);
    }
  }, t('btn_good', dayNum)), /*#__PURE__*/React.createElement("button", {
    className: "review-btn easy",
    onClick: function onClick() {
      return rate(3);
    }
  }, t('btn_easy', dayNum))), !flipped && /*#__PURE__*/React.createElement("div", {
    className: "review-flip-hint"
  }, t('click_reveal', dayNum)));
}
function Overview(_ref10) {
  var curriculum = _ref10.curriculum,
    completed = _ref10.completed,
    setDay = _ref10.setDay,
    currentDay = _ref10.currentDay,
    phaseColors = _ref10.phaseColors || PHASE_COLORS,
    phaseNames = _ref10.phaseNames || PHASE_NAMES;
  var phaseNums = Object.keys(phaseNames).map(Number);
  return /*#__PURE__*/React.createElement("div", {
    className: "overview"
  }, /*#__PURE__*/React.createElement("div", {
    className: "overview-header"
  }, /*#__PURE__*/React.createElement("h2", null, "Course Overview \u2014 All ", curriculum.length, " Days"), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.85rem',
      color: '#999'
    }
  }, completed.size, " completed \xB7 Click a day to jump to it")), /*#__PURE__*/React.createElement("div", {
    className: "phase-legend"
  }, phaseNums.map(function (p) {
    return /*#__PURE__*/React.createElement("div", {
      key: p,
      className: "legend-item"
    }, /*#__PURE__*/React.createElement("div", {
      className: "legend-dot",
      style: {
        background: phaseColors[p]
      }
    }), /*#__PURE__*/React.createElement("span", null, phaseNames[p]));
  })), /*#__PURE__*/React.createElement("div", {
    className: "cal-grid"
  }, curriculum.map(function (lesson, i) {
    var d = i + 1;
    var col = phaseColors[lesson.phaseNum];
    var isDone = completed.has(d);
    var isCurrent = d === currentDay;
    return /*#__PURE__*/React.createElement("div", {
      key: d,
      className: "cal-day ".concat(isDone ? 'done' : '', " ").concat(isCurrent ? 'current' : ''),
      style: {
        background: col
      },
      onClick: function onClick() {
        return setDay(d);
      },
      title: "Day ".concat(d, ": ").concat(lesson.title)
    }, isDone ? 'âœ“' : d);
  })));
}
ReactDOM.createRoot(document.getElementById('root')).render(/*#__PURE__*/React.createElement(App, null));

</script>
</body>
</html>